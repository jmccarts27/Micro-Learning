<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Daily Micro-Learning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f3f4f6;
      --card: #ffffff;
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --shadow-soft: 0 8px 24px rgba(15, 23, 42, 0.08);
      --radius-lg: 16px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      max-width: 720px;
      margin: 0 auto;
      padding: 16px 16px 80px; /* space for bottom nav */
    }

    header {
      padding: 8px 4px 16px;
      margin-bottom: 4px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eff6ff;
      border: 1px solid #dbeafe;
      font-size: 11px;
      font-weight: 500;
      color: #1d4ed8;
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    h1 {
      font-size: 24px;
      margin: 10px 0 4px;
      letter-spacing: -0.03em;
    }

    .subtitle {
      font-size: 13px;
      color: var(--muted);
      max-width: 34rem;
      line-height: 1.45;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 16px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }

    .chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      white-space: nowrap;
    }

    .topic-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .topic-chip {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      font-size: 12px;
      color: var(--muted);
      cursor: pointer;
      min-height: 32px;
    }

    .topic-chip-active {
      background: #2563eb;
      color: #eff6ff;
      border-color: #2563eb;
    }

    .mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
      padding: 2px;
      gap: 2px;
    }

    .mode-btn {
      border: none;
      background: transparent;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      color: var(--muted);
      cursor: pointer;
      min-width: 60px;
    }

    .mode-btn-active {
      background: #2563eb;
      color: #f9fafb;
    }

    .lesson-topic-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    /* TIP LARGER */
    .lesson-title {
      font-size: 18px;
      font-weight: 700;
      margin: 6px 0 8px;
    }

    .lesson-text {
      font-size: 15px;
      line-height: 1.6;
      margin-bottom: 10px;
    }

    .prompt {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      background: #2563eb;
      color: #eff6ff;
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.25);
      -webkit-tap-highlight-color: transparent;
      min-height: 36px;
    }

    button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.12);
    }

    .btn-secondary {
      background: #f9fafb;
      color: var(--muted);
      border: 1px solid var(--border);
      box-shadow: none;
    }

    .btn-secondary:active {
      background: #e5e7eb;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 11px;
      min-height: 32px;
    }

    .section-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .screen { display: none; }
    .screen-active { display: block; }

    .scroll-card {
      max-height: 360px;
      overflow-y: auto;
      padding-right: 4px;
      scrollbar-width: thin;
      scrollbar-color: #d1d5db transparent;
    }

    .scroll-card::-webkit-scrollbar { width: 4px; }
    .scroll-card::-webkit-scrollbar-track { background: transparent; }
    .scroll-card::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 999px;
    }

    .list-pill {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 8px 10px;
      margin-bottom: 6px;
      background: #f9fafb;
    }

    .list-pill-title {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .list-pill-meta {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .list-pill-text {
      font-size: 12px;
      line-height: 1.45;
    }

    .controls-row {
      display: flex;
      gap: 8px;
      margin: 6px 0 8px;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 7px 12px;
      font-size: 12px;
      background: #f9fafb;
      color: var(--text);
    }

    .footer-note {
      margin-top: 10px;
      font-size: 10px;
      color: var(--muted);
      text-align: center;
    }

    .tabbar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 8px 16px 14px;
      background: #ffffff;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: center;
      z-index: 20;
    }

    .tabbar-inner {
      width: 100%;
      max-width: 720px;
      display: flex;
      gap: 8px;
    }

    .tab-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: var(--muted);
      font-size: 12px;
      padding: 8px 10px;
      cursor: pointer;
    }

    .tab-btn-active {
      background: #2563eb;
      color: #eff6ff;
      border-color: #2563eb;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.25);
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 70px;
      transform: translateX(-50%);
      background: #111827;
      color: #f9fafb;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 11px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.35);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease-out;
      z-index: 30;
    }

    .toast-visible {
      opacity: 1;
    }

    @media (min-width: 640px) {
      h1 { font-size: 26px; }
      .card { padding: 16px 18px 18px; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="badge">
        <span class="badge-dot"></span>
        Daily Micro-Learning
      </div>
      <h1>One tiny idea, every day</h1>
      <p class="subtitle">
        Rotate between Money, History, Science, Faith, and Life Skills. Read in under a minute, remember for years.
      </p>
    </header>

    <main>
      <!-- TODAY SCREEN -->
      <section class="screen screen-active" id="screen-today">
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Today‚Äôs lesson</div>
              <div class="card-subtitle" id="today-subtitle"></div>
            </div>
            <div class="mode-toggle">
              <button class="mode-btn mode-btn-active" data-mode="learn" id="btn-mode-learn">
                Learn
              </button>
              <button class="mode-btn" data-mode="quiz" id="btn-mode-quiz">
                Quiz
              </button>
            </div>
          </div>

          <div class="topic-chips" id="topic-chips-row"></div>

          <div class="lesson-topic-label" id="lesson-topic-label"></div>
          <div class="lesson-title" id="today-lesson-title"></div>
          <div class="lesson-text" id="today-lesson-text"></div>

          <div class="btn-row" id="quiz-controls" style="display:none;">
            <button id="btn-reveal" type="button" class="btn-secondary">
              Reveal answer
            </button>
          </div>

          <p class="prompt">
            Use it: explain this idea in one sentence to someone else today.
          </p>

          <div class="btn-row">
            <button id="btn-next-topic" type="button">
              Next in this topic
            </button>
            <button id="btn-random" type="button" class="btn-secondary">
              Random lesson
            </button>
            <button id="btn-copy" type="button" class="btn-secondary">
              Copy to Notes
            </button>
          </div>
        </section>
      </section>

      <!-- REFLECTION SCREEN (moved into its own tab) -->
      <section class="screen" id="screen-reflection">
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Reflection prompt</div>
              <div class="card-subtitle">
                Use with Notes, journaling, or voice memos.
              </div>
            </div>
          </div>
          <p class="section-label">Prompt</p>
          <p class="lesson-text" id="reflection-text">
            Where have I already seen this idea show up in my own life or work?
          </p>
          <div class="btn-row">
            <button id="btn-new-reflection" type="button" class="btn-secondary">
              New prompt
            </button>
          </div>
        </section>
      </section>

      <!-- LIBRARY SCREEN -->
      <section class="screen" id="screen-library">
        <section class="card scroll-card">
          <div class="card-header" style="position:sticky;top:0;background:#ffffff;z-index:2;">
            <div>
              <div class="card-title">Lesson library</div>
              <div class="card-subtitle">
                Browse or search all micro-lessons.
              </div>
            </div>
          </div>

          <div class="controls-row">
            <input id="search-input" class="search-input" type="search" placeholder="Search by title or text..." />
          </div>

          <div class="topic-chips" id="library-topic-chips"></div>

          <div id="library-list"></div>
        </section>
      </section>
    </main>

    <p class="footer-note">
      Tip: In Safari, use ‚ÄúAdd to Home Screen‚Äù to make this feel like a native app.
    </p>
  </div>

  <nav class="tabbar">
    <div class="tabbar-inner">
      <button class="tab-btn tab-btn-active" data-screen="screen-today">Today</button>
      <button class="tab-btn" data-screen="screen-reflection">Reflections</button>
      <button class="tab-btn" data-screen="screen-library">Library</button>
    </div>
  </nav>

  <div id="toast" class="toast">Copied to clipboard</div>

  <script>
    // --- Topics ---
    var TOPICS = [
      { id: "money",  name: "Money & Work",        emoji: "üí∞" },
      { id: "history", name: "History & Culture",  emoji: "üèõÔ∏è" },
      { id: "science", name: "Science & Curiosity", emoji: "üî¨" },
      { id: "faith",  name: "Bible & Faith",       emoji: "‚úùÔ∏è" },
      { id: "life",   name: "Life Skills",         emoji: "üß≠" }
    ];

    // --- Lessons ---
    var LESSONS = [
      // MONEY
      { topic: "money", title: "Pay yourself first",
        text: "Treat saving like a bill. Move a set % of income to savings the moment you‚Äôre paid and live on what‚Äôs left." },
      { topic: "money", title: "Total cost thinking",
        text: "Instead of just the price tag, ask: what is the total cost over a year in money, time, and attention?" },
      { topic: "money", title: "Avoid lifestyle creep",
        text: "When income rises, send part of the increase to savings before you let your lifestyle expand." },
      { topic: "money", title: "One-number dashboard",
        text: "Pick one simple number (e.g., savings rate or cash buffer) and track it weekly as your money ‚Äòscore‚Äô." },

      // HISTORY
      { topic: "history", title: "History rhymes",
        text: "Events don‚Äôt repeat exactly, but patterns do. Learn how past booms/busts unfolded to spot echoes today." },
      { topic: "history", title: "Incentives shape behavior",
        text: "Across eras, people respond to incentives more than ideals. To understand behavior, follow the incentives." },
      { topic: "history", title: "Survivorship bias",
        text: "We mainly hear stories from those who survived. Remember the invisible graveyard of failed attempts." },

      // SCIENCE
      { topic: "science", title: "Correlation vs causation",
        text: "If two things move together, it doesn‚Äôt prove one caused the other. Look for other explanations." },
      { topic: "science", title: "Falsifiable ideas",
        text: "A scientific claim must be testable in a way that could prove it wrong. If nothing can disprove it, it isn‚Äôt science." },
      { topic: "science", title: "Base rates first",
        text: "Before judging a specific case, ask: in situations like this in general, what usually happens?" },

      // FAITH
      { topic: "faith", title: "Head, heart, hands",
        text: "Healthy faith engages what you know, what you love, and what you do‚Äînot just one of the three." },
      { topic: "faith", title: "Small, hidden obedience",
        text: "Most real growth comes from quiet, unseen faithfulness over years, not dramatic moments." },
      { topic: "faith", title: "Guard your inputs",
        text: "What you consistently consume (media, voices, feeds) quietly shapes what you love and fear." },

      // LIFE
      { topic: "life", title: "Name the tradeoff",
        text: "Every ‚Äòyes‚Äô is a ‚Äòno‚Äô to something else. Naming what you‚Äôre giving up makes choices clearer." },
      { topic: "life", title: "Ask better questions",
        text: "Swap ‚ÄòHow was your day?‚Äô for ‚ÄòWhat was one thing that surprised you today?‚Äô Specific beats vague." },
      { topic: "life", title: "Environment beats willpower",
        text: "Change your surroundings so the right action is the default, not a heroic effort each time." }
    ];

    var REFLECTIONS = [
      "Where have I already seen this idea show up in my own life or work?",
      "If I explained this to a 10-year-old, how would I phrase it?",
      "What‚Äôs one decision today that this idea could slightly improve?",
      "If I lived this idea for 30 days, what might change?",
      "Which friend or coworker would appreciate this idea?",
      "What is one concrete example in my life that illustrates this?"
    ];

    // --- State ---
    var currentTopicId = "money";
    var currentLessonIndex = 0;
    var currentMode = "learn"; // "learn" or "quiz"
    var answerRevealed = true;
    var currentReflectionIndex = 0;

    var searchQuery = "";
    var libraryTopicFilter = "all";

    // --- DOM ---
    var todaySubtitleEl = document.getElementById("today-subtitle");
    var topicChipsRow = document.getElementById("topic-chips-row");
    var lessonTopicLabelEl = document.getElementById("lesson-topic-label");
    var todayLessonTitleEl = document.getElementById("today-lesson-title");
    var todayLessonTextEl = document.getElementById("today-lesson-text");
    var quizControlsEl = document.getElementById("quiz-controls");

    var btnModeLearn = document.getElementById("btn-mode-learn");
    var btnModeQuiz = document.getElementById("btn-mode-quiz");
    var btnReveal = document.getElementById("btn-reveal");
    var btnNextTopic = document.getElementById("btn-next-topic");
    var btnRandom = document.getElementById("btn-random");
    var btnCopy = document.getElementById("btn-copy");

    var reflectionTextEl = document.getElementById("reflection-text");
    var btnNewReflection = document.getElementById("btn-new-reflection");

    var libraryTopicChips = document.getElementById("library-topic-chips");
    var libraryListEl = document.getElementById("library-list");
    var searchInput = document.getElementById("search-input");

    var tabButtons = document.querySelectorAll(".tab-btn");
    var screens = document.querySelectorAll(".screen");
    var toastEl = document.getElementById("toast");
    var toastTimeoutId = null;

    // --- Helpers ---
    function getTopicById(id) {
      for (var i = 0; i < TOPICS.length; i++) {
        if (TOPICS[i].id === id) return TOPICS[i];
      }
      return null;
    }

    function lessonsForTopic(id) {
      var out = [];
      for (var i = 0; i < LESSONS.length; i++) {
        if (LESSONS[i].topic === id) out.push(LESSONS[i]);
      }
      return out;
    }

    function pickRandomIndex(length, exclude) {
      if (length <= 1) return 0;
      var idx;
      do { idx = Math.floor(Math.random() * length); } while (idx === exclude);
      return idx;
    }

    function getTodayBaseIndex() {
      var now = new Date();
      var days = Math.floor(now.getTime() / 86400000);
      return days % LESSONS.length;
    }

    function showToast(message) {
      toastEl.textContent = message;
      toastEl.classList.add("toast-visible");
      if (toastTimeoutId) clearTimeout(toastTimeoutId);
      toastTimeoutId = setTimeout(function () {
        toastEl.classList.remove("toast-visible");
      }, 1000);
    }

    // --- Today screen ---
    function renderTopicChips() {
      topicChipsRow.innerHTML = "";
      for (var i = 0; i < TOPICS.length; i++) {
        var t = TOPICS[i];
        var btn = document.createElement("button");
        btn.type = "button";
        btn.className = "topic-chip" + (t.id === currentTopicId ? " topic-chip-active" : "");
        btn.textContent = t.emoji + " " + t.name;
        btn.setAttribute("data-topic", t.id);
        topicChipsRow.appendChild(btn);
      }
    }

    function renderTodayLesson() {
      var lesson = LESSONS[currentLessonIndex];
      var topic = getTopicById(lesson.topic);
      todaySubtitleEl.textContent = topic ? topic.emoji + " " + topic.name : "";
      lessonTopicLabelEl.textContent = topic ? topic.emoji + " " + topic.name : "";
      todayLessonTitleEl.textContent = lesson.title;

      if (currentMode === "quiz" && !answerRevealed) {
        todayLessonTextEl.textContent = "Quiz yourself: try to recall the explanation, then tap ‚ÄòReveal answer‚Äô.";
        quizControlsEl.style.display = "";
      } else {
        todayLessonTextEl.textContent = lesson.text;
        quizControlsEl.style.display = currentMode === "quiz" ? "" : "none";
      }
    }

    function nextInTopic() {
      var pool = lessonsForTopic(currentTopicId);
      if (!pool.length) return;
      var indices = [];
      for (var i = 0; i < LESSONS.length; i++) {
        if (LESSONS[i].topic === currentTopicId) indices.push(i);
      }
      var pos = indices.indexOf(currentLessonIndex);
      if (pos === -1) pos = 0;
      var nextPos = (pos + 1) % indices.length;
      currentLessonIndex = indices[nextPos];
      answerRevealed = (currentMode === "learn");
      renderTodayLesson();
    }

    function randomLesson() {
      var newIndex = pickRandomIndex(LESSONS.length, currentLessonIndex);
      currentLessonIndex = newIndex;
      currentTopicId = LESSONS[currentLessonIndex].topic;
      answerRevealed = (currentMode === "learn");
      renderTopicChips();
      renderTodayLesson();
    }

    function setMode(mode) {
      currentMode = mode;
      answerRevealed = (mode === "learn");
      btnModeLearn.classList.toggle("mode-btn-active", mode === "learn");
      btnModeQuiz.classList.toggle("mode-btn-active", mode === "quiz");
      renderTodayLesson();
    }

    function revealAnswer() {
      answerRevealed = true;
      renderTodayLesson();
    }

    function copyToClipboard() {
      var lesson = LESSONS[currentLessonIndex];
      var topic = getTopicById(lesson.topic);
      var lines = [];
      lines.push("Lesson: " + lesson.title);
      if (topic) lines.push("Topic: " + topic.name);
      lines.push("");
      lines.push(lesson.text);
      lines.push("");
      lines.push("Reflection: " + reflectionTextEl.textContent);

      var text = lines.join("\n");
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(function () { showToast("Copied"); })
          .catch(function () { showToast("Copy failed"); });
      } else {
        showToast("Clipboard not supported");
      }
    }

    // --- Reflection ---
    function renderReflection() {
      reflectionTextEl.textContent = REFLECTIONS[currentReflectionIndex];
    }

    function shuffleReflection() {
      var newIndex = pickRandomIndex(REFLECTIONS.length, currentReflectionIndex);
      currentReflectionIndex = newIndex;
      renderReflection();
    }

    // --- Library ---
    function renderLibraryTopicChips() {
      libraryTopicChips.innerHTML = "";

      var allChip = document.createElement("button");
      allChip.type = "button";
      allChip.className = "topic-chip" + (libraryTopicFilter === "all" ? " topic-chip-active" : "");
      allChip.textContent = "üåê All";
      allChip.setAttribute("data-topic", "all");
      libraryTopicChips.appendChild(allChip);

      for (var i = 0; i < TOPICS.length; i++) {
        var t = TOPICS[i];
        var btn = document.createElement("button");
        btn.type = "button";
        btn.className = "topic-chip" + (libraryTopicFilter === t.id ? " topic-chip-active" : "");
        btn.textContent = t.emoji + " " + t.name;
        btn.setAttribute("data-topic", t.id);
        libraryTopicChips.appendChild(btn);
      }
    }

    function renderLibraryList() {
      libraryListEl.innerHTML = "";
      var list = LESSONS.slice();

      if (libraryTopicFilter !== "all") {
        list = list.filter(function (l) { return l.topic === libraryTopicFilter; });
      }

      if (searchQuery) {
        var q = searchQuery.toLowerCase();
        list = list.filter(function (l) {
          return (l.title + " " + l.text).toLowerCase().indexOf(q) !== -1;
        });
      }

      for (var i = 0; i < list.length; i++) {
        var lesson = list[i];
        var topic = getTopicById(lesson.topic);
        var div = document.createElement("div");
        div.className = "list-pill";
        div.innerHTML =
          '<div class="list-pill-title">' + lesson.title + '</div>' +
          '<div class="list-pill-meta">' + (topic ? topic.emoji + " " + topic.name : "") + '</div>' +
          '<div class="list-pill-text">' + lesson.text + '</div>';
        libraryListEl.appendChild(div);
      }

      if (!list.length) {
        var empty = document.createElement("div");
        empty.className = "list-pill-text";
        empty.style.marginTop = "8px";
        empty.textContent = "No lessons match this search yet.";
        libraryListEl.appendChild(empty);
      }
    }

    // --- Navigation ---
    function activateScreen(id) {
      for (var i = 0; i < screens.length; i++) {
        var s = screens[i];
        s.classList.toggle("screen-active", s.id === id);
      }
      for (var j = 0; j < tabButtons.length; j++) {
        var btn = tabButtons[j];
        btn.classList.toggle("tab-btn-active", btn.getAttribute("data-screen") === id);
      }
    }

    // --- Events ---
    topicChipsRow.addEventListener("click", function (evt) {
      if (!evt.target.classList.contains("topic-chip")) return;
      var id = evt.target.getAttribute("data-topic");
      currentTopicId = id;
      var pool = lessonsForTopic(id);
      if (pool.length) {
        var idx = LESSONS.indexOf(pool[0]);
        if (idx >= 0) currentLessonIndex = idx;
      }
      answerRevealed = (currentMode === "learn");
      renderTopicChips();
      renderTodayLesson();
    });

    btnModeLearn.addEventListener("click", function () { setMode("learn"); });
    btnModeQuiz.addEventListener("click", function () { setMode("quiz"); });
    btnReveal.addEventListener("click", revealAnswer);

    btnNextTopic.addEventListener("click", nextInTopic);
    btnRandom.addEventListener("click", randomLesson);
    btnCopy.addEventListener("click", copyToClipboard);

    btnNewReflection.addEventListener("click", shuffleReflection);

    libraryTopicChips.addEventListener("click", function (evt) {
      if (!evt.target.classList.contains("topic-chip")) return;
      var id = evt.target.getAttribute("data-topic");
      libraryTopicFilter = id;
      renderLibraryTopicChips();
      renderLibraryList();
    });

    searchInput.addEventListener("input", function (evt) {
      searchQuery = evt.target.value || "";
      renderLibraryList();
    });

    for (var i = 0; i < tabButtons.length; i++) {
      tabButtons[i].addEventListener("click", function (evt) {
        var id = evt.currentTarget.getAttribute("data-screen");
        activateScreen(id);
      });
    }

    // --- Init ---
    (function init() {
      currentLessonIndex = getTodayBaseIndex();
      currentReflectionIndex = 0;
      renderTopicChips();
      renderTodayLesson();
      renderReflection();
      renderLibraryTopicChips();
      renderLibraryList();
    })();
  </script>
</body>
</html>
